1. Мотивация
В системе «Александрит» выполнение заказов включает несколько компонентов и асинхронных взаимодействий. При возникновении ошибок или задержек без логирования сложно понять, что именно произошло: потерялись ли сообщения, был ли сбой в сервисе, или данные были некорректны.

Приоритет логирования и трейсинга
1. MES API — так как здесь по описанию происходят самые ресурсоёмкие и медленные операции
2. RabbitMQ интеграции (между MES и CRM) — критичное место возможной потери заказов
3. CRM API — именно здесь фиксируются финальные статусы заказов, а с описания у операторов как раз проблема в работе с CRM
А уже Shop API можно настроить позже, так как ошибки там влияют только на начальные стадии и вроде я не помню чтобы из описания там были проблемы.

Предлагаемое решение:
Используем стек Grafana Loki (ниже через сравнительную таблицу объясняем почему) как решение для логирования, таким образом имеем:
1. Поддержка структурированных логов (JSON),
2. Возможность объединения с дашбордами мониторинга
3. Разделение по профилям
4. Там вроде фильтровать удобно еще можно по времени и другим фильтрам

По политике безопасности:
1. Все логи передаются в защищённом виде (HTTPS)
2. Доступ через Grafana ограничен по ролям (DevOps, Support)
3. Логи с персональными данными (userId, email) маскируются или хэшируются
4. Логи доступа отдельно, с повышенным контролем

Политику хранения можно сделать каждой системы отдельный namespace, INFO и WARN хранить например месяц, ERROR 3 месяца, а DEBUG только для dev среды тоже месяц например

---------------------------------------------------------------------------------------------------------------------------------------------------
| Критерий                  | ELK                           | OpenSearch                | Splunk                   | Grafana Loki                 |
---------------------------------------------------------------------------------------------------------------------------------------------------
| Лицензия                  | Elastic License               | Apache License 2.0        | Проприетарная            | Apache License 2.0           |
| Стоимость                 | Платная                       | Бесплатно                 | Платная                  | Бесплатно                    |
| Интеграция с мониторингом | Ограниченная                  | Лучше, чем ELK            | Встроенные метрики       | Как раз под Grafana          |
| Структурированные логи    | Да                            | Да                        | Да                       | Да                           |
| Производительность        | Высокая, ресурсоёмкая         | Более оптимизирована      | Отличная                 | Лёгкая, быстрая              |
| Удобство фильтрации       | Хорошее (Kibana)              | Хорошее                   | Отличное                 | Отличное (LogQL)             |
| Сложность развертывания   | Высокая                       | Средняя                   | Низкая (если SaaS)       | Низкая                       |
| Безопасность              | Требует настройки             | Встроенная                | Отличная                 | RBAC, HTTPS через Grafana    |
| Масштабируемость          | Хорошая, но дорогая           | Хорошая                   | Отличная                 | Хорошая                      |
| Поддержка RBAC            | Только в платной версии       | Есть                      | Встроенная               | Через Grafana                |
---------------------------------------------------------------------------------------------------------------------------------------------------


Вообще изходя из таблицы у нас два лучших кандидата: OpenSearch и Grafana Loki.
Оба бесплатные с лицензиями под наш кейс (допустим), с возможностью настройки ролей и доступов (в Grafana Loki можно точно (на работе через SSO используем), вроде как в OpenSearch можно(в инете написано)).

Но, исходя из сравнений этих двух технологий в интернете и сводной таблицы:
https://www.peerspot.com/products/comparisons/amazon-opensearch-service_vs_grafana-loki
-----------------------------------------------------------------------------
| Условие                                           | Решение               |
-----------------------------------------------------------------------------
| Нужен  полный полнотекстовый поиск по логам**     | OpenSearch            |
| Важна лёгкость и скорость развертывания**         | Grafana Loki          |
| Уже используете Grafana для мониторинга           | Grafana Loki          |
| Нужно масштабируемое логирование с аналитикой     | OpenSearch            |
| Ограничен в ресурсах, нужен лёгкий стек           | Grafana Loki          |
| Требуется compliance, аудит, расследования        | OpenSearch            |
| Цель — трассировка микросервисов, Debug/Prod      | Grafana Loki          |
-----------------------------------------------------------------------------

Чисто из-за трассровки и использования Grafana, так как поплуярное решение, давайте остановимся на Grafana Loki
